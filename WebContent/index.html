<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>

<HEAD>
    <!--  -->
    <META http-equiv="Content-Type" content="text/html; charset=Big5">
    <META name="GENERATOR" content="IBM Software Development Platform">
    <META http-equiv="Content-Style-Type" content="text/css">
    <TITLE>聊天室 ver0.1</TITLE>
    <!-- <link rel="stylesheet" type="text/css" href="css/main.css"> -->
</HEAD>

<BODY>
    <!-- 聊天室發送訊息外觀 -->
    <div class="box box-flex">
        暱稱:
        <input type='text' id='nameInput' class="name" placeholder='暱稱'> 想傳遞內容:
        <input type='text' id='messageInput' class="message box-flex-item" placeholder='消息' autofocus>
        <button id="buttonMessage" name="送出" value="送出">送出</button>
    </div>
    <div class="box">
        聊天室:
        <br> --------------------------
        <div id='messagesDiv'></div>
    </div>
</BODY>
<script type="text/javascript">
window.onload = function() {
    var xhr = new XMLHttpRequest();
    var 聊天室的框 = document.getElementById("messagesDiv");

    //設定好回呼函數 
    xhr.onreadystatechange = function() {
        if (xhr.readyState == 4) {
            if (xhr.status == 200) {
                var str = "";
                var mssJson = JSON.parse(xhr.responseText);
                for (var k in mssJson) {
                    str += mssJson[k] + "<br>";
                }
                聊天室的框.innerHTML = str;
            } else {
                alert(xhr.status);
            }
        }
    }

    //留言發送
    function 留言發送() {
        //建立xhr物件(填入程式碼)
        var data_info = "nameInput=" + document.getElementById("nameInput").value //作者
            + "&messageInput=" + document.getElementById("messageInput").value; //不要寫死
        var url = "ChatMessage.jsp?" + data_info; //直接把資料帶在網址裡面。

        xhr.open("Get", url, true);
        console.log(url);
        xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhr.send(null);
    }

    function 傳空字串() {
        var data_info = "";
        var url = "ChatMessage.jsp?" + data_info;
        xhr.open("Get", url, true);
        xhr.send(null);
    }



    document.getElementById("buttonMessage").onclick = 留言發送;

    傳空字串();
    setInterval(傳空字串,5000);



    // var divObj = document.getElementById("test");
    // var intTest = 1;
    // setInterval(
    //     function() {
    //         intTest++;
    //         divObj.innerHTML = intTest;
    //     },
    //     1000
    // )
};
</script>

</HTML>
